<div class="container mt-4">

  <% if @offer.user == current_user %>
  <div class="d-flex justify-content-between">
    <h3 class="w-50"><%= @offer.user.username.capitalize %></h3>
    <h3 class="w-50">Proposed with barter: <%= link_to @offer.product.user.username, @offer.product.user %></h3>
  </div>

  <div class="d-flex">
    <%# <div class="col-md-6"> %>
    <div class= "new-cl w-50">
      <div class="col-md-6 accordion" id="accordionPanelsStayOpenExample">
        <div class="accordion-item">
        <h2 class="accordion-header" id="panelsStayOpen-headingOne">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
            <%= @offer.offered_product.title %>
          </button>
        </h2>
        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
          <div class="accordion-body">
          <%= @offer.offered_product.description %> <p><%= @offer.offered_product.category %> : <%= @offer.offered_product.subcategory %></p>
                  <p><strong>Address:</strong> <%= @offer.offered_product.address %></p>
          </div>
        </div>
      </div>
      <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
          User Reviews
        </button>
      </h2>
      <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
        <div class="accordion-body">
        <% @offer.offered_product.user.rated_reviews.each do |review| %>
            <li class="list-group-item"><%= link_to review.reviewer.username, user_path(review.reviewer) %>: <%= review.content %>
              <strong><%= '⭐' * review.rating %></strong>
            </li>
          <% end %>
        </div>
      </div>
    </div>
          <div class = "imgBx">
            <%= cl_image_tag  @offer.offered_product.photos.first.key, height: 400, crop: :fill%>
          </div>

  </div>
</div>

<div class= "new-cl w-50" >
  <div class="col-md-6 accordion" id="accordionPanelsStayOpenExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="panelsStayOpen-headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
        <%= @offer.product.title %>
      </button>
    </h2>
    <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
      <div class="accordion-body">
      <%= @offer.product.description %> <p><%= @offer.product.category %> : <%= @offer.product.subcategory %></p>
              <p><strong>Address:</strong> <%= @offer.product.address %></p>
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
        User Reviews
      </button>
    </h2>
    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
      <div class="accordion-body">
      <% @offer.product.user.rated_reviews.each do |review| %>
          <li class="list-group-item"><%= link_to review.reviewer.username, user_path(review.reviewer) %>: <%= review.content %>
            <strong><%= '⭐' * review.rating %></strong>
          </li>
        <% end %>
      </div>
    </div>
  </div>
<div class = "imgBx">
            <%= cl_image_tag  @offer.product.photos.first.key, height: 400, crop: :fill%>
          </div>
</div>
</div>
</div>
    <div class= 'd-flex justify-content-center mt-3'>
      <% if @offer.accepted == true %>
        <p class='border border-success p-2'>Your Offer is Accepted!</p>
      <% elsif @offer.refused == true %>
        <p class='border border-danger p-2'>Your Offer is Refused!</p>
      <% else @offer.deal == false %>
        <p class='border border-warning p-2'>Your Offer is still Pending...</p>
      <% end %>
    </div>
  <% else %>
  <div class="container mt-4">

  <div class="d-flex justify-content-between">
    <h3 class="w-50"> <%= link_to @offer.offered_product.user.username, @offer.product.user %> Proposed an Offer</h3>
    <h3 class="w-50"> <%= @offer.product.user.username.capitalize %></h3>
  </div>

  <div class="d-flex">
    <%# <div class="col-md-6"> %>
    <div class= "new-cl w-50">
      <div class="col-md-6 accordion" id="accordionPanelsStayOpenExample">
        <div class="accordion-item">
        <h2 class="accordion-header" id="panelsStayOpen-headingOne">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
            <%= @offer.offered_product.title %>
          </button>
        </h2>
        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
          <div class="accordion-body">
          <%= @offer.offered_product.description %> <p><%= @offer.offered_product.category %> : <%= @offer.offered_product.subcategory %></p>
                  <p><strong>Address:</strong> <%= @offer.offered_product.address %></p>
          </div>
        </div>
      </div>
      <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
          User Reviews
        </button>
      </h2>
      <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
        <div class="accordion-body">
        <% @offer.offered_product.user.rated_reviews.each do |review| %>
            <li class="list-group-item"><%= link_to review.reviewer.username, user_path(review.reviewer) %>: <%= review.content %>
              <strong><%= '⭐' * review.rating %></strong>
            </li>
          <% end %>
        </div>
      </div>
    </div>
          <div class = "imgBx">
            <%= cl_image_tag  @offer.offered_product.photos.first.key, height: 400, crop: :fill%>
          </div>

  </div>
</div>

<div class= "new-cl w-50" >
  <div class="col-md-6 accordion" id="accordionPanelsStayOpenExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="panelsStayOpen-headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
        <%= @offer.product.title %>
      </button>
    </h2>
    <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
      <div class="accordion-body">
      <%= @offer.product.description %> <p><%= @offer.product.category %> : <%= @offer.product.subcategory %></p>
              <p><strong>Address:</strong> <%= @offer.product.address %></p>
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
        User Reviews
      </button>
    </h2>
    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
      <div class="accordion-body">
      <% @offer.product.user.rated_reviews.each do |review| %>
          <li class="list-group-item"><%= link_to review.reviewer.username, user_path(review.reviewer) %>: <%= review.content %>
            <strong><%= '⭐' * review.rating %></strong>
          </li>
        <% end %>
      </div>
    </div>
  </div>
<div class = "imgBx">
            <%= cl_image_tag  @offer.product.photos.first.key, height: 400, crop: :fill%>
          </div>
</div>
</div>
</div>
<div class="offer-accep">
    <% if @offer.deal == false %>
      <div class='col-md-4'><%= button_to 'Accept Offer', accept_offer_path(@offer), method: :put, class: 'btn btn-outline-success' %></div>
      <div class='col-md-4'><%= button_to 'Refuse Offer', refuse_offer_path(@offer), method: :put, class: 'btn btn-outline-warning' %></div>
    <% elsif @offer.accepted == true %>
      <p>You Accepted the Offer!</p>
    <% else %>
      <p>You Refused the Offer!</p>
    <% end %>
  <% end %>

<%# <%= link_to 'Delete', @offer, method: :delete, form: { data: { turbo_confirm: 'Do you really…' } })
%>
<%# ROW %>

  <div data-controller="chatroom-subscription" data-chatroom-subscription-chatroom-id-value="<%= @offer.id %>">
    <div class="chatroom">
      <h1><strong>Messages</strong></h1>

      <div class="messages" data-chatroom-subscription-target="messages">
        <% @offer.messages.each do |message| %>
          <%= render "messages/message", message: message %>
        <% end %>
      </div>
    </div> <%# chatroom container %>

    <%= simple_form_for [@offer, @message], html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f| %>
      <%= f.input :content,
        label: false,
        placeholder: "Message",
        wrapper_html: {class: "flex-grow-1"}
      %>
      <%= f.submit "Send", class: "btn btn-primary mb-3" %>
    <% end %>
    </div> <%# stimulus container %>
  </div> <%# main container %>

</div>
